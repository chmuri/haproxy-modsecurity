global
    log stdout format raw local0
    # Ładowanie skryptu LUA, który symuluje sprawdzanie WAF
    lua-load /usr/local/etc/haproxy/modsecurity.lua

defaults
    mode http
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms

frontend http-in
    bind *:80

    # Jeśli żądanie trafia pod ścieżkę /test, zwróć statyczną odpowiedź
    acl is_test path_beg /test
    http-request return status 200 content-type text/plain string "Ta strona działa" if is_test

    # Wywołanie akcji LUA (symulacja integracji z WAF-em)
    http-request lua.modsec_check

    # Dla pozostałych żądań – kierujemy do backendu
    default_backend servers

backend servers
    # Dummy backend – nie ma faktycznego serwera, więc pozostałe żądania nie zostaną obsłużone
    # (możesz zmienić tę konfigurację, wskazując działający serwer aplikacji)
    server dummy 127.0.0.1:8080 backup
